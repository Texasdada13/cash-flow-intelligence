{% extends "base.html" %}
{% block title %}Report Generator - {{ app_name }}{% endblock %}
{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-start mb-4">
        <div>
            <h2><i class="bi bi-file-earmark-pdf me-2 text-success"></i>Report Generator</h2>
            <p class="text-muted">Professional cash flow reports for stakeholders, board presentations, and lender packages</p>
        </div>
        <a href="/reports" class="btn btn-primary"><i class="bi bi-plus-circle me-2"></i>Generate Report</a>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-2"><div class="card text-center p-3"><div class="metric-value" style="color:#198754;">6</div><div class="metric-label">Report Types</div></div></div>
        <div class="col-md-2"><div class="card text-center p-3"><div class="metric-value" style="color:#20c997;">24</div><div class="metric-label">Generated</div></div></div>
        <div class="col-md-2"><div class="card text-center p-3"><div class="metric-value" style="color:#0dcaf0;">HTML</div><div class="metric-label">Format</div></div></div>
        <div class="col-md-2"><div class="card text-center p-3"><div class="metric-value" style="color:#ffc107;">AI</div><div class="metric-label">Powered</div></div></div>
        <div class="col-md-2"><div class="card text-center p-3"><div class="metric-value" style="color:#198754;">5</div><div class="metric-label">Sections Each</div></div></div>
        <div class="col-md-2"><div class="card text-center p-3"><div class="metric-value" style="color:#fd7e14;"><30s</div><div class="metric-label">Generation Time</div></div></div>
    </div>

    <div class="row g-4">
        <div class="col-lg-7">
            <div class="card mb-4">
                <div class="card-header"><h5 class="mb-0">Available Report Types</h5></div>
                <div class="card-body" id="reportTypes"></div>
            </div>
            <div class="card mb-4">
                <div class="card-header"><h5 class="mb-0">Reports Generated by Type</h5></div>
                <div class="card-body"><canvas id="typeChart" height="260"></canvas></div>
            </div>
            <div class="card">
                <div class="card-header"><h5 class="mb-0">Sample Report: Executive Summary</h5></div>
                <div class="card-body" id="sampleReport"></div>
            </div>
        </div>
        <div class="col-lg-5">
            <div class="card mb-4">
                <div class="card-header"><h5 class="mb-0">Report Distribution</h5></div>
                <div class="card-body"><canvas id="distChart" height="240"></canvas></div>
            </div>
            <div class="card mb-4">
                <div class="card-header"><h5 class="mb-0">Generation Trend</h5></div>
                <div class="card-body"><canvas id="trendChart" height="200"></canvas></div>
            </div>
            <div class="card">
                <div class="card-header"><h5 class="mb-0"><i class="bi bi-clock-history me-2 text-info"></i>Recent Reports</h5></div>
                <div class="card-body" id="recentReports"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block extra_js %}
<script>
const REPORTS = [
    {type:'Executive Summary',icon:'bi-file-earmark-richtext',desc:'High-level overview for C-suite executives with key metrics and strategic recommendations',sections:['Financial Overview','Key Metrics','Risk Summary','Recommendations','Next Steps'],generated:8,color:'#198754'},
    {type:'Board Presentation',icon:'bi-easel',desc:'Detailed presentation for board meetings with trends, comparisons, and strategic outlook',sections:['Company Performance','Financial Trends','Market Position','Strategic Initiatives','Q&A Prep'],generated:5,color:'#20c997'},
    {type:'Investor Update',icon:'bi-graph-up-arrow',desc:'Financial update for investors and stakeholders with growth metrics and projections',sections:['Revenue Growth','Cash Position','Market Expansion','Key Milestones','Forward Guidance'],generated:4,color:'#0dcaf0'},
    {type:'Lender Package',icon:'bi-bank',desc:'Documentation package for lenders with compliance data and financial covenants',sections:['Financial Statements','Covenant Compliance','Cash Flow Analysis','Collateral Summary','Risk Mitigation'],generated:3,color:'#ffc107'},
    {type:'Detailed Analysis',icon:'bi-search',desc:'Comprehensive analysis with deep-dive metrics, benchmarks, and improvement recommendations',sections:['Detailed Metrics','Trend Analysis','Benchmark Comparison','Gap Analysis','Action Plan'],generated:2,color:'#fd7e14'},
    {type:'Team Report',icon:'bi-people',desc:'Operational report for finance team with actionable tasks and weekly priorities',sections:['Weekly Summary','AR/AP Status','Cash Forecast','Team Tasks','Escalations'],generated:2,color:'#6f42c1'}
];

// Report Types
document.getElementById('reportTypes').innerHTML = REPORTS.map(r =>
    `<div style="padding:14px;border-radius:10px;background:rgba(255,255,255,0.03);margin-bottom:10px;border-left:3px solid ${r.color};">
        <div class="d-flex align-items-start gap-3">
            <div style="width:48px;height:48px;border-radius:10px;background:${r.color}20;display:flex;align-items:center;justify-content:center;flex-shrink:0;"><i class="bi ${r.icon}" style="color:${r.color};font-size:1.3rem;"></i></div>
            <div class="flex-grow-1">
                <div class="d-flex justify-content-between"><strong>${r.type}</strong><span class="badge bg-secondary">${r.generated} generated</span></div>
                <small class="text-muted">${r.desc}</small>
                <div class="mt-2 d-flex flex-wrap gap-1">${r.sections.map(s => `<span class="badge" style="background:rgba(255,255,255,0.1);font-size:0.65rem;">${s}</span>`).join('')}</div>
            </div>
        </div>
    </div>`
).join('');

// Reports by Type
new Chart(document.getElementById('typeChart'), {
    type: 'bar',
    data: {
        labels: REPORTS.map(r => r.type),
        datasets: [{label:'Generated',data:REPORTS.map(r=>r.generated),backgroundColor:REPORTS.map(r=>r.color+'99')}]
    },
    options: {responsive:true, indexAxis:'y', scales:{x:{ticks:{color:'var(--muted-color)'},grid:{color:'rgba(255,255,255,0.05)'}},y:{ticks:{color:'var(--muted-color)',font:{size:10}},grid:{color:'rgba(255,255,255,0.1)'}}}, plugins:{legend:{display:false}}}
});

// Distribution Donut
new Chart(document.getElementById('distChart'), {
    type: 'doughnut',
    data: {
        labels: REPORTS.map(r => r.type),
        datasets: [{data:REPORTS.map(r=>r.generated),backgroundColor:REPORTS.map(r=>r.color)}]
    },
    options: {responsive:true, plugins:{legend:{position:'bottom',labels:{color:'var(--muted-color)',font:{size:10}}}}}
});

// Generation Trend
new Chart(document.getElementById('trendChart'), {
    type: 'line',
    data: {
        labels: ['Sep','Oct','Nov','Dec','Jan','Feb'],
        datasets: [{label:'Reports',data:[2,3,4,5,4,6],borderColor:'#198754',backgroundColor:'rgba(25,135,84,0.1)',fill:true,tension:0.3}]
    },
    options: {responsive:true, scales:{y:{min:0,ticks:{color:'var(--muted-color)',stepSize:1},grid:{color:'rgba(255,255,255,0.1)'}},x:{ticks:{color:'var(--muted-color)'},grid:{color:'rgba(255,255,255,0.05)'}}}, plugins:{legend:{labels:{color:'var(--muted-color)'}}}}
});

// Sample Executive Summary
const SAMPLE = [
    {title:'Financial Overview',content:'Q1 2026 shows strong cash position at $842K with 18-month runway. Revenue trending up 12% QoQ with improving margins. Operating expenses remain controlled at 68% of revenue, down from 72% last quarter.'},
    {title:'Key Metrics',content:'Cash on Hand: $842K | Monthly Burn: $68K | Cash Runway: 18 months | DSO: 42 days | DPO: 28 days | Current Ratio: 1.8 | Quick Ratio: 1.2 | Free Cash Flow Margin: 8.5%'},
    {title:'Risk Assessment',content:'Overall risk level: Medium. Primary concern is DSO above industry benchmark of 35 days. AR aging shows 8% of invoices beyond 90 days. Cash reserves are below the recommended 60-day threshold at 45 days.'},
    {title:'Recommendations',content:'1. Implement early-pay discount program to reduce DSO by 7 days (+$28K). 2. Renegotiate top 3 vendor terms to Net 35-45 (+$35K float). 3. Build cash reserve to 60-day minimum ($100K target). 4. Automate AR collection reminders.'},
    {title:'Next Steps',content:'Schedule vendor negotiation meetings by Feb 28. Deploy automated AR system by Mar 15. Present cash reserve plan to board at March meeting. Review and update 13-week forecast weekly.'}
];

document.getElementById('sampleReport').innerHTML = SAMPLE.map(s =>
    `<div style="padding:12px;border-radius:8px;background:rgba(255,255,255,0.03);margin-bottom:8px;">
        <strong style="color:#20c997;">${s.title}</strong>
        <p class="text-muted mb-0 mt-1" style="font-size:0.85rem;">${s.content}</p>
    </div>`
).join('');

// Recent Reports
const RECENT = [
    {title:'Executive Summary - Q1 2026',date:'Feb 10, 2026',type:'Executive Summary'},
    {title:'Board Presentation - Feb 2026',date:'Feb 8, 2026',type:'Board Presentation'},
    {title:'Investor Update - Q4 2025',date:'Jan 30, 2026',type:'Investor Update'},
    {title:'Weekly Team Report',date:'Jan 27, 2026',type:'Team Report'},
    {title:'Lender Compliance Package',date:'Jan 20, 2026',type:'Lender Package'},
    {title:'Cash Flow Analysis Report',date:'Jan 15, 2026',type:'Detailed Analysis'}
];
document.getElementById('recentReports').innerHTML = RECENT.map(r =>
    `<div class="d-flex justify-content-between align-items-center mb-2" style="padding:8px 12px;border-radius:6px;background:rgba(255,255,255,0.03);">
        <div><strong style="font-size:0.85rem;">${r.title}</strong><br><small class="text-muted">${r.type}</small></div>
        <small class="text-muted">${r.date}</small>
    </div>`
).join('');
</script>
{% endblock %}
